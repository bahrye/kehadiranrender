<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Ceklok</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 2rem auto; padding: 1rem; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background-color: #0070f3; color: white; border: none; cursor: pointer; }
        button:disabled { background-color: #ccc; }
        .loading { display: none; text-align: center; }
    </style>
</head>
<body>

    <h2>Absensi Manual</h2>

    <form name="submit-to-google-sheet">
        <label>Nama Lengkap</label>
        <input name="Nama" type="text" placeholder="Nama Anda" required>

        <label>Status</label>
        <select name="Status">
            <option value="Masuk">Absen Masuk</option>
            <option value="Pulang">Absen Pulang</option>
            <option value="Izin">Izin/Sakit</option>
        </select>

        <input name="Koordinat" type="hidden" id="koordinat">

        <button type="submit" id="btnKirim">Kirim Absensi</button>
    </form>

    <div class="loading" id="loading">Sedang mengirim...</div>
    <p id="pesan"></p>

    <script>
        // GANTI URL INI DENGAN URL WEB APP ANDA DARI LANGKAH 1
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxVbp0o9I_PBg5ftijWF71FdoPOsfDSkgtemYYuSzdiu3V4MbMiLwZEMr5UnGJAdO2p/exec';
        
        const form = document.forms['submit-to-google-sheet'];
        const btnKirim = document.getElementById('btnKirim');
        const loading = document.getElementById('loading');
        const pesan = document.getElementById('pesan');
        const inputKoordinat = document.getElementById('koordinat');

        // Ambil Lokasi saat halaman dimuat
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                inputKoordinat.value = position.coords.latitude + ", " + position.coords.longitude;
            }, function(err) {
                alert("Harap izinkan akses lokasi untuk melakukan absensi.");
            });
        } else {
            alert("Browser tidak mendukung Geolocation.");
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            if(!inputKoordinat.value) {
                alert("Lokasi belum terdeteksi. Pastikan GPS aktif.");
                return;
            }

            btnKirim.disabled = true;
            loading.style.display = 'block';

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    loading.style.display = 'none';
                    pesan.innerText = "Absensi Berhasil!";
                    form.reset();
                    btnKirim.disabled = false;
                    // Reset koordinat setelah reset form
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(pos => {
                             inputKoordinat.value = pos.coords.latitude + ", " + pos.coords.longitude;
                        });
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    pesan.innerText = "Gagal mengirim! Coba lagi.";
                    btnKirim.disabled = false;
                    console.error('Error!', error.message);
                });
        });
    </script>
</body>
</html>
